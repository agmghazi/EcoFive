@model ChangeCurrentProfileViewModel
@inject UserManager<ApplicationUser> _userManager
@{
    ViewBag.Title = "تعديل الملف الشخصى";
    var user= await _userManager.GetUserAsync(User);

    var PhotoPath = "/Files/Users/ProfileImages/" + (user.PhotoPath == null || user.PhotoPath =="" ? "noImage.png":user.PhotoPath );

}

<div class="container float-right text-right">
    <h1 class="mb-5">تعديل الملف الشخصى</h1>

    <form method="post" class="mt-3" enctype="multipart/form-data">
        <div asp-validation-summary="All" class="alert alert-danger"></div>

        
        <div class="form-group row mb-4">
            <div class="col-sm-12 col-md-7">
                <div class="small-12 medium-2 large-2 columns">
                    <div class="circle">
                        <!-- User Profile Image -->
                        <img class="profile-pic" src="@PhotoPath" asp-append-version="true">

                    </div>

                    <div class="p-image">
                        <i class="fa fa-camera upload-button"></i>
                        <input class="file-upload" asp-for="PhotoPath" onchange="return fileValidation()"  id="file" type="file" accept=".JPEG,.JPG,.PNG"/>
                    </div>
                </div>
            </div>
            <label class="col-form-label text-md-right col-12 col-md-3 col-lg-3 ">الصوره الشخصية</label>
        </div>


        <div class="form-group row">
            <div class="col-sm-10">
                <input asp-for="CurrentPassword" class="form-control text-right">
                <span asp-validation-for="CurrentPassword" class="text-danger"></span>
            </div>
            <label asp-for="CurrentPassword" class="col-sm-2 col-form-label"></label>
        </div>

        <div class="form-group row">
            <div class="col-sm-10">
                <input asp-for="NewPassword" class="form-control text-right">
                <span asp-validation-for="NewPassword" class="text-danger"></span>
            </div>
            <label asp-for="NewPassword" class="col-sm-2 col-form-label"></label>
        </div>

        <div class="form-group row">
            <div class="col-sm-10">
                <input asp-for="ConfirmPassword" class="form-control text-right">
                <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
            </div>
            <label asp-for="ConfirmPassword" class="col-sm-2 col-form-label"></label>
        </div>


        <div class="form-group row">
            <div class="col-sm-10">
                <input asp-for="Email" class="form-control text-right">
                <span asp-validation-for="Email" class="text-danger"></span>
            </div>
            <label asp-for="Email" class="col-sm-2 col-form-label"></label>
        </div>
        <div class="form-group row">
            <div class="col-sm-10">
                <input asp-for="UserName" class="form-control text-right">
                <span asp-validation-for="UserName" class="text-danger"></span>
            </div>
            <label asp-for="UserName" class="col-sm-2 col-form-label"></label>
        </div>

        <div class="form-group row">
            <div class="col-sm-10">
                <input asp-for="FullName" class="form-control text-right">
                <span asp-validation-for="FullName" class="text-danger"></span>
            </div>
            <label asp-for="FullName" class="col-sm-2 col-form-label"></label>
        </div>

        <div class="form-group row">
            <div class="col-sm-10">
                <select dir="rtl" id="ddCountries" asp-for="CountryId" asp-items="@(new SelectList(ViewBag.Countries,"Id","Name",new{Model.CountryId}))" class="form-control"><option>أختر</option></select>
            </div>
            <label asp-for="CountryId" class="col-sm-2 col-form-label"></label>
        </div>

        <div class="form-group row">
            <div class="col-sm-10">
                <select dir="rtl" id="ddGovernorate" asp-for="GovernorateId" asp-items="@(new SelectList(ViewBag.Governorate,"Id","Name",new{Model.GovernorateId}))" class="form-control"></select>
            </div>
            <label asp-for="GovernorateId" class="col-sm-2 col-form-label"></label>
        </div>

        <div class="form-group row">
            <div class="col-sm-10">
                <select dir="rtl" id="ddCity" asp-for="CityId" asp-items="@(new SelectList(ViewBag.City,"Id","Name",new{Model.CityId}))" class="form-control"></select>
            </div>
            <label asp-for="CityId" class="col-sm-2 col-form-label"></label>
        </div>

        <div class="form-group row">
            <div class="col-sm-10">
                <input asp-for="PhoneNumber" class="form-control text-right">
            </div>
            <label asp-for="PhoneNumber" class="col-sm-2 col-form-label"></label>
        </div>

        <div class="form-group row">
            <div class="col-sm-10 ">
                <a asp-controller="Administraion" asp-action="ListUsers" class="btn btn-danger m-3 btn-lg">الغاء</a>
                <button type="submit" class="btn btn-primary m-3 btn-lg ">تعديل</button>
            </div>
        </div>
    </form>
</div>
@section Scripts{
    <script>
        $(function () {
            $("#ddCountries").change(function () {

                $.getJSON("/Admin/Account/FindGovernorates",
                    { id: $("#ddCountries").val() },
                    function (d) {
                        var row = "";
                        $("#ddGovernorate").empty();
                        $("#ddCity").empty();
                        row += "<option selected disabled >أختر</option>";
                        $.each(d,
                            function (i, v) {
                                row += "<option value=" + v.id + ">" + v.name + "</option>";
                            });
                        $("#ddGovernorate").html(row);
                    });
            });
            $("#ddGovernorate").change(function () {
                $.getJSON("/Admin/Account/Findcities",
                    { id: $("#ddGovernorate").val() },
                    function (d) {
                        var row = "";
                        $("#ddCity").empty();
                        row += "<option selected disabled >أختر</option>";
                        $.each(d,
                            function (i, v) {
                                row += "<option value=" + v.id + ">" + v.name + "</option>";
                            });
                        $("#ddCity").html(row);
                    });
            });
        });
        //document.querySelector("#alertmsgButton").addEventListener("click", function () {
        //    var tSomeStyleClasses = document.getElementsByClassName("invisible");

        //    while (tSomeStyleClasses.length) {
        //        tSomeStyleClasses[0].classList.remove("invisible");
        //    }
        //});

        $(document).ready(function() {
            var readURL = function(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('.profile-pic').attr('src', e.target.result);
                    }
    
                    reader.readAsDataURL(input.files[0]);
                }
            }
    

            $(".file-upload").on('change', function(){
                readURL(this);
            });
    
            $(".upload-button").on('click', function() {
                $(".file-upload").click();
            });
        });

        function fileValidation() { 
            var fileInput =document.getElementById('file'); 
              
            var filePath = fileInput.value; 
          
            // Allowing file type 
            var allowedExtensions =  
                /(\.JPEG|\.JPG|\.PNG)$/i; 
              
            if (!allowedExtensions.exec(filePath)) { 
                $.confirm({
                    title: '!تنبية',
                    content: 'jpg , jpeg , png يرجى اختيار الصوره بصيغ',
                    buttons: {
                        موافق: function () {
                            
                        }
                    }
                });


                fileInput.value = ''; 
                return false; 
            }  
        } 

        $("#alertmsg").fadeTo(2000, 500).slideUp(1000,
            function () {
                $("#alertmsg").hide();
            });

    </script>

}

@if (ViewBag.Message != null)
{
    <div class="alert alert-success alert-has-icon w-25" id="alertmsg">
        <div class="alert-icon"><i class="far fa-lightbulb"></i></div>
        <div class="alert-body">
            <div class="alert-title">تنبية</div>
            @ViewBag.Message
        </div>
    </div>

}
